---
---
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Harness</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/layout.css"></link>

    <script src="https://unpkg.com/js-yaml@3.12.0/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@10.0.0/dist/markdown-it.min.js"></script>
    <script src="https://unpkg.com/turndown@7.0.0/dist/turndown.js"></script>    

    <script src="https://unpkg.com/@isomorphic-git/lightning-fs"></script>
    <script src="https://unpkg.com/isomorphic-git@beta"></script>

    <script>

    </script>
    
    <script type="module">
     import { Helpers, Editor } from '/assets/js/eleventor.js';

     const $ = Helpers;

     /* construct the editor */
     let elty = window.elty = new Editor();
     let CWD  = "/";

     /* tags up the load button with a click handle so that we clone the repo */
     document.querySelector('#clone').addEventListener('click', async (event) => {
       let url = $.dataFor( event.target );
       let fs  = new LightningFS();
       await fs.init( url );
       elty.clone({ fileSystem: fs });
     }, false);
     
     /* when we clone the repo, we need to do something */
     elty.addEventListener("clone", async () => {
       let entries = await elty.fs.promises.readdir("/");
       let node = $.listBuilder( entries, {
	 ordered: false,
	 mapped : [ 'a', (a) => {
	   a.addEventListener('click', (event) => {
	     console.log(event.target.text);
	   })
	 }, 'li' ]
       });

       let listing = document.querySelector('#listing');
       while (listing.firstChild) { listing.removeChild(listing.firstChild) }
       listing.appendChild( node );
     });
     
    </script>
  </head>

  <body>
    <header>
      <h1>Editor</h1>
    </header>
    <section>
      <label for="repository">Git repository: </label>
      <input id="repository" type="text" name="repository" value="https://github.com/jamesaduncan/osom.guide.git">
      <button data-for="#repository" data-property="value" id="clone">Load</button>
      <section id="listing">
      </section>
    </section>
    <details>
      <summary>Document metadata</summary>
      <section id="metadata">
      </section>
    </details>
    <details class="editor" open="true">
      <summary></summary>
      {% include './toolbar.html' %}
      <section id="editor" contenteditable="true"></section>
    </details>
    <footer>
      <span class="copyright">Copyright 2021 Stance Global Ltd</span>
    </footer>
    <script src="/assets/js/content-editor.js"></script>
  </body>
</html>
